import util from 'util';
import path from 'path';

const handler = async (m, { groupMetadata, conn, text }) => {
    const mentionUser = (a) => '@' + a.split('@')[0];
    
    if (!text) return conn.reply(m.chat, 
        `${emoji} Por favor, ingresa una categor√≠a para el Top 10 (por ejemplo, !top m√°s activos).`, 
        m
    );

    const participants = groupMetadata.participants.map(v => v.id);
    
    // Obtener 10 participantes aleatorios √∫nicos
    const winners = [];
    while (winners.length < 10) {
        const randomUser = pickRandom(participants);
        if (!winners.includes(randomUser)) {
            winners.push(randomUser);
        }
    }

    const randomEmoji = pickRandom(['üèÜ', 'üéñÔ∏è', 'üåü', '‚ú®', 'üî•', 'üíé', 'üëë', '‚ö°', 'üíØ', 'üëè']);
    const randomSound = Math.floor(Math.random() * 70);
    const soundUrl = `https://hansxd.nasihosting.com/sound/sound${randomSound}.mp3`;

    let topList = `*${randomEmoji} TOP 10 ${text.toUpperCase()} ${randomEmoji}*\n\n`;
    
    winners.forEach((user, index) => {
        topList += `*${index + 1}. ${mentionUser(user)}*\n`;
    });

    // Enviar sonido de celebraci√≥n
    await conn.sendMessage(m.chat, { 
        audio: { url: soundUrl }, 
        mimetype: 'audio/mp4',
        ptt: true 
    });

    // Enviar la lista del Top 10 con menciones
    await conn.sendMessage(m.chat, { 
        text: topList,
        mentions: winners 
    }, { quoted: m });
}

handler.help = ['top <categor√≠a>', 'top10 <categor√≠a>'];
handler.command = ['top', 'top10', 'ranking'];
handler.tags = ['fun', 'group'];
handler.group = true;
handler.register = true;

export default handler;

function pickRandom(list) {
    return list[Math.floor(Math.random() * list.length)];
}