const handler = async (m, { conn, usedPrefix, command }) => {
  try {
    // Verificar grupo y permisos
    if (!m.isGroup) {
      return conn.reply(m.chat, '‚ö†Ô∏è Este comando solo funciona en grupos', m);
    }

    // Restablecer el enlace de invitaci√≥n del grupo
    await conn.groupRevokeInvite(m.chat);
    
    // Obtener nuevo enlace de invitaci√≥n
    const newInviteCode = await conn.groupInviteCode(m.chat);
    const newLink = `https://chat.whatsapp.com/${newInviteCode}`;

    // Enviar confirmaci√≥n al solicitante
    await conn.reply(
      m.sender,
      `üîó *Nuevo enlace de invitaci√≥n del grupo:*\n${newLink}\n\n` +
      `‚úÖ El enlace anterior ha sido revocado`,
      m
    );

    // Notificar al grupo (opcional)
    await conn.reply(
      m.chat,
      `üì¢ El enlace de invitaci√≥n del grupo ha sido restablecido por @${m.sender.split('@')[0]}`,
      m,
      { mentions: [m.sender] }
    );

  } catch (error) {
    console.error('Error al restablecer enlace:', error);
    
    const errorMessages = {
      '401': '‚ùå Necesito permisos de administrador para restablecer el enlace',
      '404': '‚ùå Grupo no encontrado',
      'default': `‚ö†Ô∏è Fall√≥ al restablecer el enlace: ${error.message}`
    };
    
    await conn.reply(
      m.chat,
      errorMessages[error.statusCode] || errorMessages.default,
      m
    );
  }
};

// Configuraci√≥n del comando
handler.help = ['revoke'];
handler.tags = ['grupo'];
handler.command = ['revoke', 'resetlink', 'restablecer'];
handler.group = true;
handler.admin = true;      // Requiere admin del usuario
handler.botAdmin = true;   // Requiere admin del bot

export default handler;