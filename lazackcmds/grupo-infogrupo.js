const handler = async (m, { conn, participants, groupMetadata }) => {
  // Obtener foto de perfil del grupo o usar icono por defecto
  const pp = await conn.profilePictureUrl(m.chat, 'image').catch(() => global.icono);

  // Obtener configuraciones del grupo desde la base de datos
  const {
    antiLink = false, detect = false, welcome = false, modoadmin = false,
    autoRechazar = false, nsfw = false, autoAceptar = false, 
    reaction = false, isBanned = false, antifake = false
  } = global.db.data.chats[m.chat] || {};

  // Preparar lista de administradores
  const groupAdmins = participants.filter(p => p.admin);
  const listAdmin = groupAdmins
    .map((v, i) => `${i + 1}. @${v.id.split('@')[0]}`)
    .join('\n') || 'No admins';

  // Identificar al creador del grupo
  const owner = groupMetadata.owner || 
                groupAdmins.find(p => p.admin === 'superadmin')?.id || 
                `${m.chat.split('-')[0]}@s.whatsapp.net`;

  // Formatear informaci√≥n del grupo
  const text = `*‚ú¶ GROUP INFORMATION ‚ú¶*

‚ùÄ *ID:* ${groupMetadata.id}
‚öò *Name:* ${groupMetadata.subject}
‚ùñ *Members:* ${participants.length} participants
‚ú∞ *Creator:* @${owner.split('@')[0]}
‚ú• *Admins (${groupAdmins.length}):*
${listAdmin}

*‚öôÔ∏è GROUP SETTINGS*

‚óà *Bot Status:* ${isBanned ? '‚ùå Disabled' : '‚úÖ Enabled'} 
‚óà *Welcome:* ${welcome ? '‚úÖ On' : '‚ùå Off'}
‚óà *Detect:* ${detect ? '‚úÖ On' : '‚ùå Off'}  
‚óà *Anti-Link:* ${antiLink ? '‚úÖ On' : '‚ùå Off'} 
‚óà *Auto-Accept:* ${autoAceptar ? '‚úÖ On' : '‚ùå Off'}
‚óà *Auto-Reject:* ${autoRechazar ? '‚úÖ On' : '‚ùå Off'}
‚óà *NSFW:* ${nsfw ? '‚úÖ On' : '‚ùå Off'}
‚óà *Admin Mode:* ${modoadmin ? '‚úÖ On' : '‚ùå Off'}
‚óà *Reactions:* ${reaction ? '‚úÖ On' : '‚ùå Off'}
‚óà *Anti-Fake:* ${antifake ? '‚úÖ On' : '‚ùå Off'}

*üìù Description:*
${groupMetadata.desc?.toString() || 'No description'}`.trim();

  // Enviar mensaje con foto de grupo y menciones
  await conn.sendFile(
    m.chat,
    pp,
    'group.jpg',
    text,
    m,
    false,
    { mentions: [...groupAdmins.map(v => v.id), owner] }
  );
};

// Configuraci√≥n del comando
handler.help = ['groupinfo'];
handler.tags = ['group'];
handler.command = ['groupinfo', 'ginfo', 'infogroup', 'gpinfo'];
handler.group = true;
handler.register = true;

export default handler;