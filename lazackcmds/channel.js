import axios from 'axios';

let handler = async (m, { conn, usedPrefix, command, text }) => {
  // Verificar que el usuario haya ingresado un enlace de canal
  if (!text) {
    return conn.reply(
      m.chat, 
      'üö© Por favor proporciona un enlace de canal, jefe\n\n`Ejemplo:`\n' + `> *${usedPrefix + command}* https://whatsapp.com/channel/`, 
      m
    );
  }
  await m.react('üïì'); // Reaccionar con reloj mientras se procesa

  try {
    const url = `https://itzpire.com/stalk/whatsapp-channel?url=${encodeURIComponent(text)}`;
    const response = await axios.get(url);

    if (response.data && response.data.status === 'success') {
      const channelData = response.data.data;
      let txt = '`üëë  I N F O R M A C I √ì N  -  D E L  C A N A L  W H A T S A P P`\n\n';
      txt += `    ‚ú©  *Imagen* : ${channelData.img}\n`;
      txt += `    ‚ú©  *T√≠tulo* : ${channelData.title}\n`;
      txt += `    ‚ú©  *Seguidores* : ${channelData.followers}\n`;
      txt += `    ‚ú©  *Descripci√≥n* : ${channelData.description}\n\n`;

      let imge = channelData.img;
      let title = channelData.title;

      // Enviar imagen con la informaci√≥n del canal
      await conn.sendMessage(m.chat, { image: { url: imge }, caption: txt }, { quoted: m });
      await m.react('‚úÖ'); // Confirmaci√≥n de √©xito
    } else {
      await m.react('‚úñÔ∏è'); // Reacci√≥n de error
      await conn.reply(m.chat, 'No se encontr√≥ informaci√≥n sobre este canal de WhatsApp.', m);
    }
  } catch (error) {
    console.error(error);
    await m.react('‚úñÔ∏è');
    await conn.reply(m.chat, 'Ocurri√≥ un error al buscar informaci√≥n del canal.', m);
  }
}

// Categor√≠a y ayuda
handler.tags = ['info'];
handler.help = ['whatsappchannelinfo *<link>*'];
handler.command = ['channelstalk', 'chinfo'];
handler.register = true;

export default handler;